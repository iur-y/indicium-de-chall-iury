version: 1
env:
  DBT_CLEAN_PROJECT_FILES_ONLY: 'false'
default_environment: dev
project_id: 1bceae40-d78c-4c96-b676-5202907a7292
environments:
- name: dev
- name: staging
- name: prod

plugins:
  extractors:

  - name: tap-postgres
    variant: meltanolabs
    pip_url: git+https://github.com/MeltanoLabs/tap-postgres.git@v0.0.9
    config:
      database: northwind
      host: db
      user: northwind_user
      default_replication_method: FULL_TABLE
    catalog: catalog/tap_postgres_catalog_file.json
    select:
    - public*.*


  - name: tap-csv
    variant: meltanolabs
    pip_url: git+https://github.com/MeltanoLabs/tap-csv.git@v1.0.1


  loaders:

  - name: target-csv
    variant: hotgluexyz
    pip_url: git+https://github.com/hotgluexyz/target-csv.git@v0.3.10


  - name: target-postgres
    variant: meltanolabs
    pip_url: git+https://github.com/MeltanoLabs/target-postgres.git@v0.0.13
    config:
      user: northwind_user
      host: db
      database: newdb
      default_target_schema: public
      load_method: overwrite


  utilities:

  - name: dbt-postgres
    variant: dbt-labs
    pip_url: dbt-core dbt-postgres git+https://github.com/meltano/dbt-ext.git@main
    config:
      host: db
      port: 5432
      user: northwind_user
      dbname: newdb
      schema: analytics


  - name: airflow
    variant: apache
    pip_url: git+https://github.com/meltano/airflow-ext.git@main apache-airflow==2.8.1
      --constraint 
      https://raw.githubusercontent.com/apache/airflow/constraints-2.8.1/constraints-no-providers-${MELTANO__PYTHON_VERSION}.txt
    settings:
    - name: meltano.project_dir
      env: MELTANO_PROJECT_ROOT
      value: $MELTANO_PROJECT_ROOT
      label: Root Project Directory
    # for documentation purposes, as changing these values here didn't change them in airflow.cfg
    config:
      core:
        dags_are_paused_at_creation: 'False'
        executor: LocalExecutor
      database:
        sql_alchemy_conn: postgresql+psycopg2://airflow_user:airflow_pass@db:5432/airflow_db
